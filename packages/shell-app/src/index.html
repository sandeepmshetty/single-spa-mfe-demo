<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Single-SPA Micro-Frontend Demo - Modern micro-frontend architecture">
    <title>Single-SPA MFE Demo</title>

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: http://localhost:* data: blob:; connect-src 'self' ws://localhost:* http://localhost:* https:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <!-- Zone.js for Angular (only needed if using Angular MFE) -->
    <script src="https://cdn.jsdelivr.net/npm/zone.js@0.14.10/fesm2015/zone.min.js"></script>

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3e%3ctext y='.9em' font-size='90'%3eüöÄ%3c/text%3e%3c/svg%3e">

    <!-- Application Styles -->
    <link rel="stylesheet" href="./styles.css">
</head>

<body>
</head>

<body>
    <!-- Layout Fix Applied: v2.0 - 2025-10-01 -->
    <!-- Application Header -->
    <header class="app-header">
        <div class="header-container">
            <div class="app-title">
                <span class="app-logo">üöÄ</span>
                <div>
                    <h1>Single-SPA MFE Demo</h1>
                    <p class="app-subtitle">Modern Micro-Frontend Architecture</p>
                </div>
            </div>

            <nav class="main-nav" role="navigation" aria-label="Main navigation">
                <a href="/" class="nav-item" data-route="home" aria-label="Home">
                    üè† Home
                </a>
                <a href="/users" class="nav-item" data-route="users" aria-label="User Management">
                    üë• Users
                </a>
                <a href="/products" class="nav-item" data-route="products" aria-label="Products">
                    üõçÔ∏è Products
                </a>
                <a href="/dashboard" class="nav-item" data-route="dashboard" aria-label="Dashboard">
                    üìä Dashboard
                </a>
            </nav>

            <div class="user-info">
                <div class="health-indicator">
                    <span class="health-dot" id="health-dot"></span>
                    <span id="health-status">All Systems Operational</span>
                </div>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    üåô
                </button>
                
                <!-- User Menu -->
                <div class="user-menu-container" id="user-menu-container">
                    <div style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;" id="user-menu-trigger">
                        <div class="user-avatar" id="user-avatar">üë§</div>
                        <div class="auth-status" id="auth-status">Sign In</div>
                    </div>
                    
                    <!-- Dropdown Menu (shown when authenticated) -->
                    <div class="user-menu-dropdown" id="user-menu-dropdown">
                        <div class="user-menu-header">
                            <div class="user-menu-email" id="user-menu-email">user@example.com</div>
                            <div class="user-menu-id" id="user-menu-id">ID: ...</div>
                        </div>
                        <div class="user-menu-actions">
                            <button class="user-menu-button logout" id="logout-button">
                                <span>üö™</span>
                                <span>Sign Out</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-container" role="main">
        <!-- Welcome Section (shown on home route) -->
        <section id="welcome-section" class="welcome-section">
            <h2 class="welcome-title">Welcome to Micro-Frontend Architecture</h2>
            <p class="welcome-description">
                Experience the power of Single-SPA orchestrating multiple frameworks working together seamlessly.
                Each micro-frontend is independently developed, deployed, and maintained.
            </p>

            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">‚öõÔ∏è</span>
                    <h3 class="feature-title">React MFE</h3>
                    <p class="feature-description">
                        User management and authentication features built with React 18,
                        showcasing modern hooks and state management.
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üíö</span>
                    <h3 class="feature-title">Vue MFE</h3>
                    <p class="feature-description">
                        Product catalog and shopping functionality using Vue 3 Composition API
                        with Pinia for state management.
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üÖ∞Ô∏è</span>
                    <h3 class="feature-title">Angular MFE</h3>
                    <p class="feature-description">
                        Analytics dashboard and reporting with Angular 17,
                        featuring RxJS reactive programming patterns.
                    </p>
                </div>

                <div class="feature-card">
                    <span class="feature-icon">üîó</span>
                    <h3 class="feature-title">Shared Library</h3>
                    <p class="feature-description">
                        Common utilities, components, and communication layer
                        providing seamless integration across all micro-frontends.
                    </p>
                </div>
            </div>
        </section>

        <!-- Error Display Container -->
        <div id="error-container" style="display: none;"></div>

        <!-- Micro-Frontend Container -->
        <div class="mfe-container" id="mfe-container" style="display: none;">
            <!-- Loading State -->
            <div class="loading-container" id="loading-container" style="display: none;">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading micro-frontend...</p>
            </div>

            <!-- Single-SPA will mount micro-frontends here -->
            <div id="single-spa-application:react-mfe"></div>
            <div id="single-spa-application:vue-mfe"></div>
            <div id="single-spa-application:angular-mfe"></div>
        </div>
    </main>

    <!-- System JS Import Map - Environment Specific -->
    <script type="systemjs-importmap">
    {
        "imports": {
            "rxjs": "https://cdn.jsdelivr.net/npm/rxjs@7.8.1/dist/bundles/rxjs.umd.min.js",
            "react": "https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js",
            "react-dom": "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js",
            "vue": "https://cdn.jsdelivr.net/npm/vue@3.3.7/dist/vue.global.prod.js",
            "zone.js": "@empty",
            "@angular/core": "https://cdn.jsdelivr.net/npm/@angular/core@17.0.0/bundles/core.umd.min.js",
            "@angular/platform-browser": "https://cdn.jsdelivr.net/npm/@angular/platform-browser@17.0.0/bundles/platform-browser.umd.min.js",
            "@angular/platform-browser-dynamic": "https://cdn.jsdelivr.net/npm/@angular/platform-browser-dynamic@17.0.0/bundles/platform-browser-dynamic.umd.min.js"
        }
    }
    </script>

    <!-- Import Map Configuration -->
    <script src="./config/import-map.config.js"></script>

    <!-- SystemJS -->
    <script src="https://cdn.jsdelivr.net/npm/systemjs@6.14.2/dist/system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/systemjs@6.14.2/dist/extras/amd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/systemjs@6.14.2/dist/extras/named-exports.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/systemjs@6.14.2/dist/extras/named-register.min.js"></script>

    <!-- Single-SPA Global Scripts -->
    <script src="https://unpkg.com/single-spa@5.9.5/lib/system/single-spa.min.js"></script>

    <!-- Load the shell application -->
    <script>
        System.import('./shell-app.js').catch(err => {
            console.error('Failed to load shell application:', err);
            document.getElementById('error-container').innerHTML = `
                <div class="error-container">
                    <span class="error-icon">‚ö†Ô∏è</span>
                    <span class="error-message">Failed to load the application. Please refresh the page.</span>
                    <button class="error-close" onclick="window.location.reload()">‚Üª</button>
                </div>
            `;
            document.getElementById('error-container').style.display = 'block';
        });
    </script>
</body>

</html>